<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roblox Game Rating Questionnaire</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1>Roblox Game Rating Questionnaire</h1>
        <div class="form-container">
            <form id="gameForm">
                <!-- User Information Card -->
                <div class="question-card" id="page-0">
                    <h2>0. User Information</h2>
                    <p>Please provide your name and group name.</p>
                    <label for="username">Name:</label><br>
                    <input type="text" id="username" name="username" required><br>
                    <label for="groupname">Group Name:</label><br>
                    <input type="text" id="groupname" name="groupname" required><br>
                    <button type="button" class="next-button" onclick="showNextPage(1)">Next</button>
                </div>

                <!-- Violence Card -->
                <div class="question-card" id="page-1">
                    <h2>1. Does the game contain violence?</h2>
                    <p>Description: Violence includes physical confrontations, fighting, or harming other characters.</p>
                    <input type="radio" id="violence-yes" name="violence" value="yes">
                    <label for="violence-yes">Yes</label><br>
                    <input type="radio" id="violence-no" name="violence" value="no">
                    <label for="violence-no">No</label>
                    <div class="sub-questions" id="violence-sub">
                        <label>Type of violence:</label><br>
                        <input type="radio" id="violence-mild" name="violenceType" value="1">
                        <label for="violence-mild">Mild (e.g., cartoonish violence)</label><br>
                        <input type="radio" id="violence-moderate" name="violenceType" value="2">
                        <label for="violence-moderate">Moderate (e.g., realistic but non-gory)</label><br>
                        <input type="radio" id="violence-extensive" name="violenceType" value="3">
                        <label for="violence-extensive">Extensive (e.g., graphic or gory)</label>
                    </div>
                    <button type="button" class="next-button" onclick="showNextPage(2)">Next</button>
                </div>

                <!-- Language Card -->
                <div class="question-card" id="page-2">
                    <h2>2. Does the game use strong language?</h2>
                    <p>Description: Strong language includes profanity or explicit language.</p>
                    <input type="radio" id="language-yes" name="language" value="yes">
                    <label for="language-yes">Yes</label><br>
                    <input type="radio" id="language-no" name="language" value="no">
                    <label for="language-no">No</label>
                    <div class="sub-questions" id="language-sub">
                        <label>Extent of language:</label><br>
                        <input type="radio" id="language-mild" name="languageType" value="1">
                        <label for="language-mild">Mild (e.g., occasional mild swearing)</label><br>
                        <input type="radio" id="language-moderate" name="languageType" value="2">
                        <label for="language-moderate">Moderate (e.g., frequent mild to moderate swearing)</label><br>
                        <input type="radio" id="language-extensive" name="languageType" value="3">
                        <label for="language-extensive">Extensive (e.g., strong profanity)</label>
                    </div>
                    <button type="button" class="next-button" onclick="showNextPage(3)">Next</button>
                </div>

                <!-- Mature Themes Card -->
                <div class="question-card" id="page-3">
                    <h2>3. Does the game contain mature themes?</h2>
                    <p>Description: Mature themes include topics such as drug use, sexual content, or serious crime.</p>
                    <input type="radio" id="mature-yes" name="mature" value="yes">
                    <label for="mature-yes">Yes</label><br>
                    <input type="radio" id="mature-no" name="mature" value="no">
                    <label for="mature-no">No</label>
                    <div class="sub-questions" id="mature-sub">
                        <label>Type of mature content:</label><br>
                        <input type="radio" id="mature-light" name="matureType" value="1">
                        <label for="mature-light">Light (e.g., references to drugs or mild sexual content)</label><br>
                        <input type="radio" id="mature-moderate" name="matureType" value="2">
                        <label for="mature-moderate">Moderate (e.g., scenes involving drugs or violence)</label><br>
                        <input type="radio" id="mature-heavy" name="matureType" value="3">
                        <label for="mature-heavy">Heavy (e.g., explicit drug use, intense violence)</label>
                    </div>
                    <button type="button" class="next-button" onclick="showNextPage(4)">Next</button>
                </div>

                <!-- Fear Card -->
                <div class="question-card" id="page-4">
                    <h2>4. Does the game contain frightening content?</h2>
                    <p>Description: Frightening content includes scary or disturbing imagery or themes.</p>
                    <input type="radio" id="fear-yes" name="fear" value="yes">
                    <label for="fear-yes">Yes</label><br>
                    <input type="radio" id="fear-no" name="fear" value="no">
                    <label for="fear-no">No</label>
                    <div class="sub-questions" id="fear-sub">
                        <label>Type of frightening content:</label><br>
                        <input type="radio" id="fear-mild" name="fearType" value="1">
                        <label for="fear-mild">Mild (e.g., spooky but not graphic)</label><br>
                        <input type="radio" id="fear-moderate" name="fearType" value="2">
                        <label for="fear-moderate">Moderate (e.g., disturbing imagery)</label><br>
                        <input type="radio" id="fear-extensive" name="fearType" value="3">
                        <label for="fear-extensive">Extensive (e.g., intense horror or graphic content)</label>
                    </div>
                    <button type="button" class="next-button" onclick="showNextPage(5)">Next</button>
                </div>

                <!-- Competitive Card -->
                <div class="question-card" id="page-5">
                    <h2>5. Is the game intended for a competitive audience?</h2>
                    <p>Description: Competitive games involve skill-based challenges and may include intense gameplay.</p>
                    <input type="radio" id="competitive-yes" name="competitive" value="yes">
                    <label for="competitive-yes">Yes</label><br>
                    <input type="radio" id="competitive-no" name="competitive" value="no">
                    <label for="competitive-no">No</label>
                    <div class="sub-questions" id="competitive-sub">
                        <label>Level of competitiveness:</label><br>
                        <input type="radio" id="competitive-light" name="competitiveType" value="1">
                        <label for="competitive-light">Light (e.g., casual competitive elements)</label><br>
                        <input type="radio" id="competitive-moderate" name="competitiveType" value="2">
                        <label for="competitive-moderate">Moderate (e.g., balanced competitive gameplay)</label><br>
                        <input type="radio" id="competitive-intensive" name="competitiveType" value="3">
                        <label for="competitive-intensive">Intensive (e.g., highly competitive with intense challenges)</label>
                    </div>
                    <button type="button" class="next-button" onclick="evaluateGame()">Submit</button>
                </div>
            </form>
        </div>
        <div id="result" class="result"></div>
    </div>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.2/dist/umd/supabase.min.js"></script>
<script>
    // Supabase client configuration
    const SUPABASE_URL = 'https://utgmmvofnginuwvzajig.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV0Z21tdm9mbmdpbnV3dnphamlnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MjE5NTczMzksImV4cCI6MjAzNzUzMzMzOX0.YWH5Ceiz0OI_h8M6wG1M2UsDXM_43i5UdopmYLGO7aE';
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

async function submitFormData(data) {
    const { error } = await supabase
        .from('game_ratings')
        .insert([data]);

    if (error) {
        console.error('Error inserting data:', error);
        alert('An error occurred while saving the data.');
    } else {
        alert('Data saved successfully!');
        window.location.reload();
    }
}

function showNextPage(pageNumber) {
    const totalPages = 6; // Total number of pages including user info
    for (let i = 0; i < totalPages; i++) {
        document.getElementById(`page-${i}`).style.display = (i === pageNumber) ? 'block' : 'none';
    }
    // Handle sub-questions visibility
    handleSubQuestionsVisibility();
}

function handleSubQuestionsVisibility() {
    const questions = ['violence', 'language', 'mature', 'fear', 'competitive'];
    questions.forEach(question => {
        const yesRadio = document.getElementById(`${question}-yes`);
        const subQuestionsDiv = document.getElementById(`${question}-sub`);
        if (yesRadio && subQuestionsDiv) {
            subQuestionsDiv.style.display = yesRadio.checked ? 'block' : 'none';
        }
    });
}

function evaluateGame() {
    const form = document.getElementById('gameForm');
    const result = document.getElementById('result');

    // Extract user information
    const username = form.elements['username'].value;
    const groupname = form.elements['groupname'].value;

    // Extract main question values
    const violence = form.elements['violence']?.value === 'yes' ? 1 : 0;
    const violenceType = parseInt(form.elements['violenceType'] ? form.elements['violenceType'].value : 0, 10);
    const language = form.elements['language']?.value === 'yes' ? 1 : 0;
    const languageType = parseInt(form.elements['languageType'] ? form.elements['languageType'].value : 0, 10);
    const mature = form.elements['mature']?.value === 'yes' ? 1 : 0;
    const matureType = parseInt(form.elements['matureType'] ? form.elements['matureType'].value : 0, 10);
    const fear = form.elements['fear']?.value === 'yes' ? 1 : 0;
    const fearType = parseInt(form.elements['fearType'] ? form.elements['fearType'].value : 0, 10);
    const competitive = form.elements['competitive']?.value === 'yes' ? 1 : 0;
    const competitiveType = parseInt(form.elements['competitiveType'] ? form.elements['competitiveType'].value : 0, 10);

    // Calculate the total score
        // Define weights
        const weights = {
            violence: 1,
            language: 1,
            mature: 1,
            fear: 0.5,
            competitive: 0.5
        };

        // Define sub-question weights
        const subWeights = {
            violence: [0.5, 1, 2],
            language: [0.5, 1, 2],
            mature: [1, 2, 3],
            fear: [0.5, 1, 1.5],
            competitive: [0.5, 1, 1.5]
        };

        // Calculate the total score
        const score = (
            (violence * weights.violence + (violenceType ? subWeights.violence[violenceType - 1] : 0)) +
            (language * weights.language + (languageType ? subWeights.language[languageType - 1] : 0)) +
            (mature * weights.mature + (matureType ? subWeights.mature[matureType - 1] : 0)) +
            (fear * weights.fear + (fearType ? subWeights.fear[fearType - 1] : 0)) +
            (competitive * weights.competitive + (competitiveType ? subWeights.competitive[competitiveType - 1] : 0))
        );

    // Determine the rating based on the score
    let rating = '';

    if (score >= 10) {
        rating = '18+';
    } else if (score >= 8) {
        rating = '17+';
    } else if (score >= 6) {
        rating = '16+';
    } else if (score >= 4) {
        rating = '15+';
    } else if (score >= 3) {
        rating = '14+';
    } else if (score >= 2) {
        rating = '13+';
    } else if (score >= 1) {
        rating = '10+';
    } else {
        rating = '7+';
    }

    result.textContent = `The suitable age rating for this game is: ${rating}`;

    // Prepare data to submit
    const formData = {
        username: username,
        groupname: groupname,
        violence: violence,
        violencetype: violenceType,
        language: language,
        languagetype: languageType,
        mature: mature,
        maturetype: matureType,
        fear: fear,
        feartype: fearType,
        competitive: competitive,
        competitivetype: competitiveType,
        rating: rating
    };

    // Submit form data
    submitFormData(formData);
}

// Event listeners for showing/hiding sub-questions
document.addEventListener('change', handleSubQuestionsVisibility);

// Show the first page on load
window.onload = function() {
    showNextPage(0);
};
</script>
</body>
</html>
